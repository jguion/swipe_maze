<!DOCTYPE html>
<html>
  <head>
  	<title>Swipe Maze</title>
  	<meta name="viewport" content="width=device-width, initial-scale=0.75"> 
  	<style> 
	    <!--
	    body{
	    	background-color: #efece6;
	    	font-family: 'Helvetica Neue','Arial', sans-serif;
	    }
	    #maze_holder {
	    	float:left;
	    	margin:0 auto;
	    	overflow: hidden;
	    }
	    #maze_layout {
	    	-webkit-transition:all 0.5s ease-in-out;
		    -moz-transition:all 0.5s ease-in-out;
			-o-transition:all 0.5s ease-in-out;
		  	transition:all 0.5s ease-in-out;
	    }
	    .maze_block {
	    	background-color:#333;
	    	border:6px solid #e1e1e1;
	    	display: block;
	    	float:left;
	    	font-size: 35px;
	    	margin:0;
	    	padding:0;
	    	text-align: center;
			text-shadow: 0 1px 0 #333;
	    }
      	.maze_block.good{
    		background-color:#5FBA50;
    	}
    	.maze_block.bad{
    		background-color:#e96955;
	    	}
	    ul{
	    	-webkit-padding-start: 0px;
	    	list-style-type: none;
	    }
	    .button{
	    	-webkit-transition-duration: 0.3s;
	    	-webkit-transition-property: -webkit-transform;
	    	-webkit-transform: translateZ(0);
	    	background-color:#5FBA50;
	    	border:2px solid #333;
	    	border-radius:5px;
	    	float: left;
	    	height:25px;
	    	margin-right: 10px;
	    	vertical-align: baseline;
	    }
	    .button:hover{
	    	-webkit-transform: scale(1.1);
	    }
	    .nav{
	    	height:30px;
	    	width:100%;
	    }
	    .message{
	    	float:left;
	    	max-width: 275px;
	    	padding: 10px;
	    }
	    #maze_timer{
	    	padding-bottom: 10px;
	    }
	    #countdown_timer{
	    	display: none;
	    	padding-bottom: 10px;
	    }
	    .settings_btn{
	    	float:right;
	    }
	    .settings_modal,.main{
	    	-webkit-backface-visibility: hidden;
	    	backface-visibility: hidden;
	    	position: absolute;
			top: 0;
	    } 
	    .settings_modal{
	    	/*-webkit-transition:all 0.5s ease-in-out;
		  	transition:all 0.5s ease-in-out;*/
		  	-webkit-transform: rotateY(180deg);

		  	margin-right: 20px;
		  	/*max-height: 0px !important;*/
		  	overflow:hidden;
			right: 0;

	    }
	    .main{

			left: 0;
			z-index: 2;
	    }
	    .instructions{
	    	-webkit-transition:all 0.5s ease-in-out;
		    -moz-transition:all 0.5s ease-in-out;
			-o-transition:all 0.5s ease-in-out;
		  	transition:all 0.5s ease-in-out;
	    	max-height: 0px !important;
	    	overflow: hidden;
	    }

	    .show{
	    	max-height: 300px !important;
	    }
	    .map{
	    	-webkit-transition:all 0.5s ease-in-out;
		    -moz-transition:all 0.5s ease-in-out;
			-o-transition:all 0.5s ease-in-out;
		  	transition:all 0.5s ease-in-out;
	    	background-color: #e9e9e9;
	    	border 3px solid rgb(233, 105, 85);
	    	float:left;
	    	height: 100px;
	    	margin: 0px 10px;
	    	width: 100px;
	    }
	    #my_location{
	    	-webkit-transition-property: -webkit-transform;
	    	-webkit-transform: translate;
	    	-webkit-transition:all 0.5s ease-in-out;
		    -moz-transition:all 0.5s ease-in-out;
			-o-transition:all 0.5s ease-in-out;
		  	transition:all 0.5s ease-in-out;
		  	background-color: rgb(95, 186, 80);
		  	border-radius: 50%;
		  	float:left;

	    }

	    .map_poi{
	    	-webkit-transition-property: -webkit-transform;
	    	-webkit-transform: translate;
	    	-webkit-transition:all 0.5s ease-in-out;
		    -moz-transition:all 0.5s ease-in-out;
			-o-transition:all 0.5s ease-in-out;
		  	transition:all 0.5s ease-in-out;
		  	background-color: gold;
		  	border-radius: 50%;`
		  	display: none;
	    }

	    #pageone{
	    	-webkit-perspective: 800px;
	    	-webkit-transition: 0.6s;
			-webkit-transform-style: preserve-3d;
			-webkit-overflow-scrolling: touch; 
			border:2px solid #e1e1e1;
	    }
	    #zombies{
	    	-webkit-transform: rotateY(180deg);
	    	background-image:url('img/zombie-banner.jpg');
			height: 50px;
			width: 412px;
	    }
	    .more_time{
	    	background-image:url('img/Clock.gif');
	    	background-size:100px 100px;
			background-repeat:no-repeat;
	    }
	    #flipper{
	    	-webkit-transition: 0.6s;
			-webkit-transform-style: preserve-3d;
	    	border:2px solid #1b1b1b;
	    }

	    #flipper.flipped {
			-webkit-transform: rotateY(180deg);


			position: relative;
		}
		[data-role=page]{
			height: 100% !important; 
			position:relative !important;
		}
		[data-role=footer]{
			bottom:-45px; 
			position:absolute !important; 
			top: auto !important; 
			width:100%;
		}  
	    -->
	</style>
  	<link rel="stylesheet" href="plugins/jquery.mobile-1.4.2.min.css">
  	<script type='text/javascript' src="plugins/jquery-2.1.0.min.js"></script>
  	<script src="plugins/jquery.mobile-1.4.2.min.js"></script>
  	<script type='text/javascript' src="plugins/jquery.touchSwipe.min.js"></script>
  	<script type='text/javascript' src="plugins/jquery.timer.js"></script>
  	<script type="text/javascript">
  		var maze_matrix; 
		var DIRECTIONS = [[0,1], [0,-1], [-1,0], [1,0]];
		//easy - standard game, easy algorithm, walls are highlighted to tell which direction you can go
		//blind - walls are not highlighted so you need to navigate the maze based on memory
		//zombie - zombies are on your tail, you cannot backtrack or you will die
		var MODES = ['easy', 'blind', 'zombies'];
		var ALGORITHMS = ['simple', 'advanced'];
		var size = 15;
		var maze_block_size = 400;
		var translate_percent = 100.00 / size;
		var mode = 'easy';
		var algorithm = 'advanced';
		var last_direction;
		var num_swipes = 0;
		var min_swipes;
		var visited;
		var max_score = 0;
		var num_deaths = 0;
		var more_time_location=[0,0];
		var disable_swipe = false;


		/**
		**********				   * *
		HELPER FUNCTIONS  		   * *
		**********				  ******
								   ***
									*
		**/
		function is_caught_by_zombies(direction, last_direction){
			var opposite_direction = {'right':'left',
									  'left':'right',
									  'up':'down',
									  'down':'up'}
			return opposite_direction[direction] == last_direction;
		}

		function show_all(){
			for(var i=0; i<maze_matrix.length; i++){
				var row = maze_matrix[i];
				for(var j=0; j<row.length; j++){
					var maze_block = maze_matrix[i][j]
					var $maze_block = $('#r'+i+'c'+j);
					$maze_block.css('height', '75px');
					$maze_block.css('width', '75px');
				}
			}

			$('#maze_holder').css('max-height', '1180px');
			$('#maze_holder').css('max-width', '1180px');
			$('#maze_layout').css('min-height', '1180px');
			$('#maze_layout').css('min-width', '1180px');
		}

		function initialize_matrix(){
			matrix = new Array(size);
			for(var i=0; i<size; i++) {
			    matrix[i] = new Array(size);
			    for(var j=0; j<size; j++) {
			    	matrix[i][j] = 0;
			    }
			}
			return matrix
		}

		function get_neighbors(x, y){
			var node = maze_matrix[y][x]; //top, right, bottom, down
			var neighbors = [];
			if(node[0] == 1){
				neighbors.push([x, y-1])
			}
			if(node[1] == 1){
				neighbors.push([x+1, y])
			}
			if(node[2] == 1){
				neighbors.push([x, y+1])
			}
			if(node[3] == 1){
				neighbors.push([x-1, y])
			}
			return neighbors
		}

		function shortest_path(x, y, endX, endY){
			visited[x][y] = 1
			var neighbors = get_neighbors(x,y);
			for(var i =0; i < neighbors.length; i++){
				var neighbor = neighbors[i];
				var neighbor_x = neighbor[0];
				var neighbor_y = neighbor[1];
				if(neighbor_x == endX && neighbor_y == endY){
					return 1;
				}
				else{
					if(visited[neighbor_x][neighbor_y] == 1){
						continue;
					}else{
						var steps =  shortest_path(neighbor_x, neighbor_y, endX, endY)
						if(steps && steps > 0){
							return 1 + steps;
						}else{
							continue
						}
					}
				}
			}
		}

		function shortest_path_length(endX, endY){
			visited = initialize_matrix();
			return shortest_path(0, 0, endX, endY, visited);
		}

		function format_timer(ms){
			if(x < 0){
				return "0 seconds";
			}
			var x = ms / 1000
			var seconds = x % 60
			x = Math.floor(x / 60)
			var minutes = x % 60

			return minutes + " minutes "+ seconds+" seconds"
		}

		var MazeTimer = new(function() {
		    var $maze_timer;
		    var incrementTime = 1000;
		    var currentTime = 0;

		    $(function() {
		        $maze_timer = $('#maze_timer');
		        MazeTimer.Timer = $.timer(updateTimer, incrementTime, true);
		    });
		    this.currentTime = function(){
		    	return currentTime;
		    }
		    function updateTimer() {
		        var timeString = format_timer(currentTime);
		        $maze_timer.html(timeString);
		        currentTime += incrementTime;
		    }
		    this.resetStopwatch = function() {
		        MazeTimer.Timer.stop().once();
		    };

		});

		var CountdownTimer = new(function() {
		    var $countdown_timer;
		    var incrementTime = 1000;
		    var currentTime = 60000;

		    this.startCountdownTimer = function(){
		    	$countdown_timer = $('#countdown_timer');
		        CountdownTimer.Timer = $.timer(updateTimer, incrementTime, true);
		    }
		    this.currentTime = function(){
		    	return currentTime;
		    }
		    this.setCurrentTime = function(current_time){
		    	currentTime = current_time;
		    }
		    function updateTimer() {
		        var timeString = format_timer(currentTime);
		        $countdown_timer.html(timeString);
		        currentTime -= incrementTime;
		        if(currentTime <= 0){
		        	var score = format_timer(MazeTimer.currentTime());
		        	CountdownTimer.Timer.stop();
		        	$("#popup_msg").html("<p>You ran out of time. Total time is "+score+"<p>")
		        	$("#msgPopup").popup("open")
		        	disable_swipe = true;
		        	this.resetStopwatch();
		        }
		    }
		    this.resetStopwatch = function() {
		    	currentTime = 60000;
		        CountdownTimer.Timer.stop().once();
		    };

		});

		/*
			Score should be calculated on a number of factors including time and number of swipes
			** Possibly add in difficulty multiplier
			Max points = 1000
			Max points = (Swipe Score(up to 500) + Time score (up to 500)) * Multipliers
			Swipe Score
			- Perfect = Max points
			- Double = Half points
			- Triple = Quarter points

			Time Score
			- # seconds <= Min swipes = Max Points
			- # seconds * 2 <= Min swipes = Half points
			- # seconds *3 <= Min swipes = Quarter points

			Multipliers
			- For each death, subtract 5% of score
			- Multiplier size of maze / 10 * total score 



		*/
		function calculate_score(){
			var time = MazeTimer.currentTime() / 1000;
			var swipe_score = min_swipes / num_swipes * 500;
			var time_score = time / num_swipes * 500;
			var total_score = swipe_score + time_score;
			var death_multiplier = 0.05 * num_deaths;
			death_multiplier = 1-death_multiplier;
			total_score = total_score * death_multiplier;
			var size_multiplier = size / 10;
			total_score = total_score * size_multiplier;
			return Math.floor(total_score);
		}

		/**
		**********				   		* *
		ADVANCED MAZE ALGORITHMS	    * *
		**********				  	   ******
								   	    ***
										 *
		**/
		//Using Recursive backtracking depth first search algorithm
		//maze_matrix is created with [Y-Axis][X-Axis][Neighbors(top, right, down, left)]
		function create_advanced_maze_matrix(){
			var x = size;
			var y = size;
			var total_cells = x * y;
			var cells = new Array();
			var unvisited = new Array();

			for(var i=0; i<y; i++){
				cells[i] = new Array();
				unvisited[i] = new Array();
				for(var j=0; j<x; j++){
					cells[i][j] = [0,0,0,0];
					unvisited[i][j] = true;
				}
			}

			var current_cell = [Math.floor(Math.random()*y), Math.floor(Math.random()*x)];
			var path = [current_cell];
			unvisited[current_cell[0]][current_cell[1]] = false;
			var visited = 1;

			while(visited < total_cells){
				var potential = [[current_cell[0]-1, current_cell[1], 0, 2], //top
								 [current_cell[0], current_cell[1]+1, 1, 3], //right
								 [current_cell[0]+1, current_cell[1], 2, 0], //bottom
								 [current_cell[0], current_cell[1]-1, 3, 1]]; //left
				
				var neighbors = new Array();

				for(var l=0; l<4; l++){
					if(potential[l][0] > -1 &&
					   potential[l][0] < y &&
					   potential[l][1] > -1 &&
					   potential[l][1] < x &&
					   unvisited[potential[l][0]][potential[l][1]]){
						neighbors.push(potential[l]);
					}
				}

				if(neighbors.length){
					next = neighbors[Math.floor(Math.random()*neighbors.length)];
					cells[current_cell[0]][current_cell[1]][next[2]] = 1;
					cells[next[0]][next[1]][next[3]] = 1;
					unvisited[next[0]][next[1]] = false;
					visited++;
					current_cell = [next[0], next[1]];
					path.push(current_cell);
				}else{
					current_cell = path.pop();
				}

			}

			maze_matrix = cells;

		}

		function add_borders_advanced(r, c){
			var $block = $('#r'+r+'c'+c);
			var block = maze_matrix[r][c];

			var top_border =  block[0] == 1 ? '#5FBA50' : '#e96955'
			var right_border = block[1] == 1 ? '#5FBA50' : '#e96955'
			var bottom_border = block[2] == 1 ? '#5FBA50' : '#e96955'
			var left_border = block[3] == 1 ? '#5FBA50' : '#e96955'

			$block.css('border-left-color', left_border);
			$block.css('border-right-color', right_border);
			$block.css('border-top-color', top_border);
			$block.css('border-bottom-color', bottom_border);
		}

		function add_more_time(){
			$(".map_poi").show();
			var $block = $('#r'+more_time_location[0]+'c'+more_time_location[1]);
			$block.addClass("more_time");

			var r = Math.floor((Math.random()*size));
			var c = Math.floor((Math.random()*size));

			more_time_location = [r,c];

			var map_translate = "translate("+c * 100+"%, "+r * 100+"%)";
			$(".map_poi").css("transform",map_translate);

			$block.delay(1000).queue(function(){$block.removeClass("more_time")});

		}

		function advanced_swipe(event, direction, distance, duration, fingerCount) {
			if(disable_swipe){
				return false;
			}
			$("#message").text("");
        	var id = event.srcElement.id;
        	var tmp = id.split('r')[1].split('c');
		  	var r = parseInt(tmp[0]);
		  	var c = parseInt(tmp[1]);
		  	var new_r = r;
		  	var new_c = c;

		  	num_swipes += 1

		  	var translate;
		  	var map_translate;
		  	translate_percent = 100.00 / size;
		  	var hit_wall = false;

		  	block = maze_matrix[r][c];

		  	if(direction == 'right' && block[3] == 1){
		  		new_c = c-1;
		  		translate = "translate(-"+new_c * translate_percent+"%, -"+r * translate_percent+"%)"
		  		map_translate = "translate("+new_c * 100+"%, "+r * 100+"%)"
		  	}else if(direction == 'left' && block[1] == 1){
		  		new_c = c+1;
		  		translate = "translate(-"+ new_c * translate_percent+"%, -"+r * translate_percent+"%)"
		  		map_translate = "translate("+ new_c * 100+"%, "+r * 100+"%)"
		  	}else if(direction == 'down' && block[0] == 1){
		  		new_r = r-1;
		  		translate = "translate(-"+c * translate_percent+"%, -"+new_r * translate_percent+"%)"
		  		map_translate = "translate("+c * 100+"%, "+new_r * 100+"%)"
			}else if(direction == 'up' && block[2] == 1){
				new_r = r+1;
		  		translate = "translate(-"+c * translate_percent+"%, -"+new_r * translate_percent+"%)"
		  		map_translate = "translate("+c * 100+"%, "+new_r * 100+"%)"
		  	}else{
		  		hit_wall = true;
		  	}

		  	var zombie_death = false;
		  	if(mode == 'zombies'){
		  		zombie_death = is_caught_by_zombies(direction, last_direction);
		  	}

		  	var dead = hit_wall || zombie_death;

	  		if(!dead){
	  			$("#maze_layout").css("transform",translate);
	  			$("#my_location").css("transform",map_translate);
	  			last_direction = direction;
	  		}else{
	  			if(zombie_death){
	  				$("#message").text("You were caught by zombies, try again");
	  			}else{
	  			$("#message").text("You ran into a wall, try again");
	  			}
	  			$("#maze_layout").css("transform","translate(0%,0%)");
	  			$("#my_location").css("transform","translate(0%,0%)");
	  			last_direction = undefined;
	  			num_deaths+=1;
	  			CountdownTimer.setCurrentTime(CountdownTimer.currentTime() - 10000);
	  		}

	  		if(mode != "scavenger_hunt" && (new_r+1 == size || new_c+1 == size)){
	  			MazeTimer.Timer.toggle();
	  			min_swipes = shortest_path_length(new_c, new_r);
	  			var score = calculate_score();
	  			if(score > max_score){
	  				max_score = score;
	  			}
				$("#message").text("Congrats! You Win!! It took "+num_swipes+" swipes to finish. Shortest path was "+min_swipes+" swipes");
				$('#r'+new_r+'c'+new_c).addClass("good");
				$('#r'+new_r+'c'+new_c).html("<p>YOU WIN!"+
											 "<br/> Your score is "+score+
											 "<br/> Max score is "+max_score+"</p>");
				disable_swipe = true;
			}else if(mode == "scavenger_hunt"){
				more_time_r = more_time_location[0];
				more_time_c = more_time_location[1];
				if(new_r == more_time_r && new_c == more_time_c){
					var more_time = Math.floor((Math.random()*30))*1000 + 30000;
					CountdownTimer.setCurrentTime(more_time + CountdownTimer.currentTime());
					add_more_time();
				}
				
			}

        }


		/**
		**********				   * *
		SIMPLE MAZE ALGORITHMS	   * *
		**********				  ******
								   ***
									*
		**/

		function generate_maze(){
			var x = 0;
			var y = 0;
			maze_matrix[x][y] = 1;
			while(x + 1 < size && y + 1 < size){
				var d = DIRECTIONS[Math.floor((Math.random()*4))];
				var dx = d[0];
				var dy = d[1];
				if(dx != 0){
					if(x + dx >= 0){
						x = x + dx;
					}
					else{
						continue;
					}
				}
				if(dy != 0){
					if(y + dy >= 0){
						y = y + dy;
					}
					else{
						continue;
					}
				}
				maze_matrix[x][y] = 1;
			}
		}

		function create_simple_maze_matrix(){
			maze_matrix = initialize_matrix();
			generate_maze();
		}

		function add_borders_simple(r, c){
			if(maze_matrix[r][c] != 1){
				return
			}
			var $block = $('#r'+r+'c'+c);
			var top_border = maze_matrix[r-1] != undefined && maze_matrix[r-1][c] == 1 ? '#5FBA50' : '#e96955'
			var bottom_border = maze_matrix[r+1] != undefined && maze_matrix[r+1][c] == 1 ? '#5FBA50' : '#e96955'
			var right_border = maze_matrix[r][c+1] == 1 ? '#5FBA50' : '#e96955'
			var left_border = maze_matrix[r][c-1] == 1 ? '#5FBA50' : '#e96955'

			$block.css('border-left-color', left_border);
			$block.css('border-right-color', right_border);
			$block.css('border-top-color', top_border);
			$block.css('border-bottom-color', bottom_border);
		}

		function simple_swipe(event, direction, distance, duration, fingerCount) {
			$("#message").text("");
        	var id = event.srcElement.id;
        	var tmp = id.split('r')[1].split('c');
		  	var r = parseInt(tmp[0]);
		  	var c = parseInt(tmp[1]);

		  	num_swipes += 1

		  	var new_r = r;
		  	var new_c = c;
		  	var translate;
		  	var map_translate;
		  	translate_percent = 100.00 / size;

		  	if(direction == 'right'){
		  		new_c = c-1;
		  		translate = "translate(-"+new_c * translate_percent+"%, -"+r * translate_percent+"%)"
		  		map_translate = "translate("+new_c * 100+"%, "+r * 100+"%)"
		  	}else if(direction == 'left'){
		  		new_c = c+1;
		  		translate = "translate(-"+ new_c * translate_percent+"%, -"+r * translate_percent+"%)"
		  		map_translate = "translate("+ new_c * 100+"%, "+r * 100+"%)"
		  	}else if(direction == 'down'){
		  		new_r = r-1;
		  		translate = "translate(-"+c * translate_percent+"%, -"+new_r * translate_percent+"%)"
		  		map_translate = "translate("+c * 100+"%, "+new_r * 100+"%)"
			}else if(direction == 'up'){
		  		new_r = r+1;
		  		translate = "translate(-"+c * translate_percent+"%, -"+new_r * translate_percent+"%)"
		  		map_translate = "translate("+c * 100+"%, "+new_r * 100+"%)"
		  	}

		  	var dead = false
		  	if(mode == 'zombies'){
		  		dead = is_caught_by_zombies(direction, last_direction);
		  	}

	  		if(!dead && maze_matrix[new_r] != undefined && maze_matrix[new_r][new_c] == 1){
	  			$("#maze_layout").css("transform",translate);
	  			$("#my_location").css("transform",map_translate);
	  			last_direction = direction;
	  		}else{
	  			if(mode == 'zombies' && dead){
	  				$("#message").text("You were caught by zombies, try again");
	  			}else{
	  			$("#message").text("You ran into a wall, try again");
	  			}
	  			$("#maze_layout").css("transform","translate(0%,0%)");
	  			$("#my_location").css("transform","translate(0%,0%)");
	  			last_direction = undefined;
	  		}

	  		if(new_r+1 == size || new_c+1 == size){
				$("#message").text("Congrats! You Win!!");
				$('#r'+new_r+'c'+new_c).addClass("good");
				$('#r'+new_r+'c'+new_c).text("YOU WIN!");
			}

        }


		/**
		**********				   * *
		SETUP MAZE	   			   * *
		**********				  ******
								   ***
									*
		**/

		function build_maze_layout(){
			for(var i=0; i<maze_matrix.length; i++){
				var row = maze_matrix[i];
				var first_row = true;
				for(var j=0; j<row.length; j++){
					$('#maze_layout').append('<div id="r'+i+'c'+j+'" class="maze_block"></div>');
					if(mode != "blind"){
						if(algorithm == 'advanced'){
							add_borders_advanced(i,j);
						}else{
							add_borders_simple(i,j);
						}
					}

					var swipe_function = algorithm == 'advanced' ? advanced_swipe : simple_swipe

					$('#r'+i+'c'+j).swipe( {
				        swipe:swipe_function,
				         threshold:0
				      });
				}
			}

			if(mode == "scavenger_hunt"){
				add_more_time();
			}

			$("#maze_holder").css("max-height", maze_block_size+12+"px");
			$("#maze_holder").css("max-width", maze_block_size+12+"px");
			$(".maze_block").css("min-height", maze_block_size+"px");
			$(".maze_block").css("min-width", maze_block_size+"px");
			$("#maze_layout").css("min-height", size*(maze_block_size+12)+"px");
			$("#maze_layout").css("min-width", size*(maze_block_size+12)+"px");
			$("#my_location").css("height", 100/size+"px");
			$("#my_location").css("width", 100/size+"px");
			$(".map_poi").css("height", 100/size+"px");
			$(".map_poi").css("width", 100/size+"px");
		}

		function new_maze(){
			$("#maze_layout").css("transform","translate(0%,0%)");
			$("#my_location").css("transform","translate(0%,0%)");
			$('#maze_layout').empty()
			num_swipes = 0;
			if(algorithm == 'advanced'){
				create_advanced_maze_matrix();
			}else{
				create_simple_maze_matrix();
			}
			build_maze_layout();
			MazeTimer.resetStopwatch();
			MazeTimer.Timer.toggle();
			if(mode == "scavenger_hunt"){
				CountdownTimer.startCountdownTimer()
				$("#maze_timer").hide();
				$("#countdown_timer").show();
				CountdownTimer.resetStopwatch();
				CountdownTimer.Timer.toggle();
			}
			num_deaths = 0;
			disable_swipe = false;
		}

		function initialize(){
			/*$('#show_all').click(
				function(){
					show_all();
				});*/
			$('#new_maze').click(
				function(){
					new_maze();
				});

			$('#settings').click(
				function () {
					$("#flipper").toggleClass("flipped")
				});
			$('#instr_btn').click(
				function () {
					$("#instructions").toggleClass("show")
				});
			$("#save_settings").click(
				function(){
					size=parseInt($("#size").val());
					maze_block_size=parseInt($("#block_pixels").val());
					mode = $("input[type='radio'][name='radio_mode']:checked").val();
					algorithm = $("input[type='radio'][name='radio_algorithm']:checked").val();
					new_maze();
					$("#flipper").toggleClass("flipped")
				});
			new_maze();
		}
	$(function(){
		$('#size').val(size);
		$("#block_pixels").val(maze_block_size);
		mode = $("input[type='radio'][name='radio_mode']:checked").val();
		algorithm = $("input[type='radio'][name='radio_algorithm']:checked").val();

	})
	</script>
	<script>
  	  //Google Analytics Tracker
	  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	  ga('create', 'UA-49944213-1', 'guion.us');
	  ga('send', 'pageview');

	</script>
  </head>
  <body onload="initialize()" class="ui-mobile-viewpoint">
  	<div data-role="page" id="pageone" data-theme="b" data-dom-cache="true">
	    <div data-role="header">
	      <h1>Swipe Maze</h1>
	      <a href="#" class="settings_btn" id="settings">Settings</a>
	      <a href="#" id="instr_btn">Instructions</a>
	    </div>

	    <div id="flipper">
	    <div id="settings_modal" class="ui-content settings_modal">
	    	<div data-role="controlgroup" data-type="horizontal">
		    	<div class="field-contain">
		    		<label for="size">Maze size (Number of blocks each direction):</label>
		    		<input type="range" name="size" id="size" min="0" max="100" value="20" data-highlight="true">
		    	</div>
		    	<div class="field-contain">
		    		<label for="block_pixels">Set size of each block (pixels)</label>
		        	<input type="text" name="block_pixels" id="block_pixels">
		        </div>
			  	<fieldset data-role="controlgroup" data-type="horizontal" data-role="fieldcontain">
			    	<legend>Choose maze algorithm:</legend>
		         	<input type="radio" name="radio_algorithm" id="radio_algorithm_simple" value="simple" />
		         	<label for="radio_algorithm_simple">Simple</label>
		         	<input type="radio" name="radio_algorithm" id="radio_algorithm_advanced" value="advanced" checked="checked" />
		         	<label for="radio_algorithm_advanced">Advanced</label>
			 	</fieldset>
			    <fieldset data-role="controlgroup" data-type="horizontal" data-role="fieldcontain">
			    	<legend>Choose a mode:</legend>
		         	<input type="radio" name="radio_mode" id="radio-choice-easy" value="easy" checked="checked" />
		         	<label for="radio-choice-easy">Normal</label>

		         	<input type="radio" name="radio_mode" id="radio-choice-blind" value="blind"  />
		         	<label for="radio-choice-blind">Blind</label>

		         	<input type="radio" name="radio_mode" id="radio-choice-zombies" value="zombies"  />
		         	<label for="radio-choice-zombies">Zombies</label>

		         	<input type="radio" name="radio_mode" id="radio-choice-scavenger-hunt" value="scavenger_hunt"  />
		         	<label for="radio-choice-scavenger-hunt">Scavenger Hunt</label>
			 	</fieldset>

			    <div id="save_settings" class="ui-btn">Save</div>
			</div>
		</div>

	    <div data-role="main" class="ui-content main">
	    	<div id="instructions" class="instructions"> Navigate through the maze by moving through green walls (Swipe away to move towards). If you hit a red wall, you will go back to the beginning. To win, reach one of the edges on the right or bottom. To change the size of the maze or other maze options, click the settings button. </div>
		  	<div data-role="controlgroup" data-type="horizontal">
			  	<!--<div id="show_all" class="ui-btn">Show All</div>-->
			  	<div id="new_maze" class="ui-btn">New Maze</div>
			  	<div id="map" class="map">
			  		<div id="my_location"></div>
			  		<div class="map_poi"></div>
			  	</div>
			  	<div class="message">
				  	<div id="maze_timer"></div>
				  	<div id="countdown_timer"></div>
				  	<div id="message"></div>
				  	<div data-role="popup" id="msgPopup" data-transition="pop" class="ui-content">
				  		<a href="#" data-rel="back" class="ui-btn ui-corner-all ui-shadow ui-btn ui-icon-delete ui-btn-icon-notext ui-btn-right">Close</a>
				  		<p id="popup_msg"></p>
				    </div>
				</div>
			</div>
		  	<div id="maze_holder">
		  		<div id="maze_layout">
		  		</div>
		  	</div>
		  </div>
		</div>
		<div data-role="footer">
		   <h1>Gui-on</h1>
		</div>
	</div>
  </body>
</html>