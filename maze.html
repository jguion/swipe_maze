<!DOCTYPE html>
<html>
  <head>
  	<title>Swipe Maze</title>
  	<meta name="viewport" content="width=device-width, initial-scale=0.75"> 
  	<style> 
	    <!--
	    body{
	    	background-color: #efece6;
	    	font-family: 'Helvetica Neue','Arial', sans-serif;
	    }
	    #maze_holder {
	    	float:left;
	    	margin:0 auto;
	    	max-height:412px;
	    	max-width: 412px;
	    	overflow: hidden;
	    }
	    #maze_layout {
	    	-webkit-transition:all 0.5s ease-in-out;
		    -moz-transition:all 0.5s ease-in-out;
			-o-transition:all 0.5s ease-in-out;
		  	transition:all 0.5s ease-in-out;
	    }
	    .maze_block {
	    	background-color:#333;
	    	border:6px solid #e1e1e1;
	    	display: block;
	    	float:left;
	    	height:400px;
	    	margin:0;
	    	padding:0;
	    	width:400px;
	    }
	    /*.maze_block:hover{
	    	-webkit-transform: scale(1.05);
	    }*/
      	.maze_block.good{
    		background-color:#5FBA50;
    	}
    	.maze_block.bad{
    		background-color:#e96955;
	    	}
	    ul{
	    	-webkit-padding-start: 0px;
	    	list-style-type: none;
	    }
	    .button{
	    	-webkit-transition-duration: 0.3s;
	    	-webkit-transition-property: -webkit-transform;
	    	-webkit-transform: translateZ(0);
	    	background-color:#5FBA50;
	    	border:2px solid #333;
	    	border-radius:5px;
	    	float: left;
	    	height:25px;
	    	margin-right: 10px;
	    	vertical-align: baseline;
	    }
	    .button:hover{
	    	-webkit-transform: scale(1.1);
	    }
	    .nav{
	    	height:30px;
	    	width:100%;
	    }
	    .message{
	    	float:left;
	    	padding: 12px;
	    }
	    .settings_btn{
	    	float:right;
	    }
	    .settings_modal,.main{
	    	-webkit-backface-visibility: hidden;
	    	position: absolute;
			top: 0;
	    } 
	    .settings_modal{
	    	/*-webkit-transition:all 0.5s ease-in-out;
		  	transition:all 0.5s ease-in-out;*/
		  	-webkit-transform: rotateY(180deg);

		  	margin-right: 20px;
		  	/*max-height: 0px !important;*/
		  	overflow:hidden;
			right: 0;

	    }
	    .main{

			left: 0;
			z-index: 2;
	    }

	    .show{
	    	max-height: 300px !important;
	    }
	    .map{
	    	-webkit-transition:all 0.5s ease-in-out;
		    -moz-transition:all 0.5s ease-in-out;
			-o-transition:all 0.5s ease-in-out;
		  	transition:all 0.5s ease-in-out;
	    	background-color: #e9e9e9;
	    	float:right;
	    	height: 100px;
	    	width: 100px;
	    }
	    .my_location{
	    	-webkit-transition-property: -webkit-transform;
	    	-webkit-transform: translate;
	    	-webkit-transition:all 0.5s ease-in-out;
		    -moz-transition:all 0.5s ease-in-out;
			-o-transition:all 0.5s ease-in-out;
		  	transition:all 0.5s ease-in-out;
	    }

	    #pageone{
	    	-webkit-perspective: 800px;
	    	-webkit-transition: 0.6s;
			-webkit-transform-style: preserve-3d;
	    }

	    #flipper{
	    	-webkit-transition: 0.6s;
			-webkit-transform-style: preserve-3d;
	    	border:1px solid #e1e1e1;
	    	height: 650px;
	    }

	    #flipper.flipped {
			-webkit-transform: rotateY(180deg);


			position: relative;
		}
	    -->
	</style>
  	<!--<script type='text/javascript' src="http://code.jquery.com/jquery-1.9.1.min.js"></script>-->
  	<link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.2/jquery.mobile-1.4.2.min.css">
  	<script type='text/javascript' src="http://code.jquery.com/jquery-2.1.0.min.js"></script>
  	<script src="http://code.jquery.com/mobile/1.4.2/jquery.mobile-1.4.2.min.js"></script>
  	<script type='text/javascript' src="plugins/jquery.touchSwipe.min.js"></script>
  	<script type="text/javascript">
  		var maze_matrix;
		var DIRECTIONS = [[0,1], [0,-1], [-1,0], [1,0]];
		//easy - standard game, easy algorithm, walls are highlighted to tell which direction you can go
		//blind - walls are not highlighted so you need to navigate the maze based on memory
		//zombie - zombies are on your tail, you cannot backtrack or you will die
		var MODES = ['easy', 'blind', 'zombies'];
		var ALGORITHMS = ['simple', 'advanced'];
		var size = 15;
		var translate_percent = 100.00 / size;
		var mode = 'easy';
		var algorithm = 'advanced';
		var last_direction;


		/**
		**********				   * *
		HELPER FUNCTIONS  		   * *
		**********				  ******
								   ***
									*
		**/
		function is_caught_by_zombies(direction, last_direction){
			var opposite_direction = {'right':'left',
									  'left':'right',
									  'up':'down',
									  'down':'up'}
			return opposite_direction[direction] == last_direction;
		}

		function show_all(){
			for(var i=0; i<maze_matrix.length; i++){
				var row = maze_matrix[i];
				for(var j=0; j<row.length; j++){
					var maze_block = maze_matrix[i][j]
					var $maze_block = $('#r'+i+'c'+j);
					$maze_block.css('height', '75px');
					$maze_block.css('width', '75px');
				}
			}

			$('#maze_holder').css('max-height', '1180px');
			$('#maze_holder').css('max-width', '1180px');
			$('#maze_layout').css('min-height', '1180px');
			$('#maze_layout').css('min-width', '1180px');
		}


		/**
		**********				   		* *
		ADVANCED MAZE ALGORITHMS	    * *
		**********				  	   ******
								   	    ***
										 *
		**/
		//Using Recursive backtracking depth first search algorithm
		function create_advanced_maze_matrix(){
			var x = size;
			var y = size;
			var total_cells = x * y;
			var cells = new Array();
			var unvisited = new Array();

			for(var i=0; i<y; i++){
				cells[i] = new Array();
				unvisited[i] = new Array();
				for(var j=0; j<x; j++){
					cells[i][j] = [0,0,0,0];
					unvisited[i][j] = true;
				}
			}

			var current_cell = [Math.floor(Math.random()*y), Math.floor(Math.random()*x)];
			var path = [current_cell];
			unvisited[current_cell[0]][current_cell[1]] = false;
			var visited = 1;

			while(visited < total_cells){
				var potential = [[current_cell[0]-1, current_cell[1], 0, 2], //top
								 [current_cell[0], current_cell[1]+1, 1, 3], //right
								 [current_cell[0]+1, current_cell[1], 2, 0], //bottom
								 [current_cell[0], current_cell[1]-1, 3, 1]]; //left
				
				var neighbors = new Array();

				for(var l=0; l<4; l++){
					if(potential[l][0] > -1 &&
					   potential[l][0] < y &&
					   potential[l][1] > -1 &&
					   potential[l][1] < x &&
					   unvisited[potential[l][0]][potential[l][1]]){
						neighbors.push(potential[l]);
					}
				}

				if(neighbors.length){
					next = neighbors[Math.floor(Math.random()*neighbors.length)];
					cells[current_cell[0]][current_cell[1]][next[2]] = 1;
					cells[next[0]][next[1]][next[3]] = 1;
					unvisited[next[0]][next[1]] = false;
					visited++;
					current_cell = [next[0], next[1]];
					path.push(current_cell);
				}else{
					current_cell = path.pop();
				}

			}

			maze_matrix = cells;

		}

		function add_borders_advanced(r, c){
			var $block = $('#r'+r+'c'+c);
			var block = maze_matrix[r][c];

			var top_border =  block[0] == 1 ? '#5FBA50' : '#e96955'
			var right_border = block[1] == 1 ? '#5FBA50' : '#e96955'
			var bottom_border = block[2] == 1 ? '#5FBA50' : '#e96955'
			var left_border = block[3] == 1 ? '#5FBA50' : '#e96955'

			$block.css('border-left-color', left_border);
			$block.css('border-right-color', right_border);
			$block.css('border-top-color', top_border);
			$block.css('border-bottom-color', bottom_border);
		}

		function advanced_swipe(event, direction, distance, duration, fingerCount) {
			$("#message").text("");
        	var id = event.srcElement.id;
        	var tmp = id.split('r')[1].split('c');
		  	var r = parseInt(tmp[0]);
		  	var c = parseInt(tmp[1]);
		  	var new_r = r;
		  	var new_c = c;

		  	var translate;
		  	var map_translate;
		  	translate_percent = 100.00 / size;
		  	var hit_wall = false;

		  	block = maze_matrix[r][c];

		  	if(direction == 'right' && block[3] == 1){
		  		new_c = c-1;
		  		translate = "translate(-"+new_c * translate_percent+"%, -"+r * translate_percent+"%)"
		  		map_translate = "translate("+new_c * 100+"%, "+r * 100+"%)"
		  	}else if(direction == 'left' && block[1] == 1){
		  		new_c = c+1;
		  		translate = "translate(-"+ new_c * translate_percent+"%, -"+r * translate_percent+"%)"
		  		map_translate = "translate("+ new_c * 100+"%, "+r * 100+"%)"
		  	}else if(direction == 'down' && block[0] == 1){
		  		new_r = r-1;
		  		translate = "translate(-"+c * translate_percent+"%, -"+new_r * translate_percent+"%)"
		  		map_translate = "translate("+c * 100+"%, "+new_r * 100+"%)"
			}else if(direction == 'up' && block[2] == 1){
				new_r = r+1;
		  		translate = "translate(-"+c * translate_percent+"%, -"+new_r * translate_percent+"%)"
		  		map_translate = "translate("+c * 100+"%, "+new_r * 100+"%)"
		  	}else{
		  		hit_wall = true;
		  	}

		  	var zombie_death = false;
		  	if(mode == 'zombies'){
		  		zombie_death = is_caught_by_zombies(direction, last_direction);
		  	}

		  	var dead = hit_wall || zombie_death;

	  		if(!dead){
	  			$("#maze_layout").css("transform",translate);
	  			$("#my_location").css("transform",map_translate);
	  			last_direction = direction;
	  		}else{
	  			if(zombie_death){
	  				$("#message").text("You were caught by zombies, try again");
	  			}else{
	  			$("#message").text("You ran into a wall, try again");
	  			}
	  			$("#maze_layout").css("transform","translate(0%,0%)");
	  			$("#my_location").css("transform","translate(0%,0%)");
	  			last_direction = undefined;
	  		}

	  		if(new_r+1 == size || new_c+1 == size){
				$("#message").text("Congrats! You Win!!");
				$('#r'+new_r+'c'+new_c).addClass("good");
				$('#r'+new_r+'c'+new_c).text("YOU WIN!");
			}

        }


		/**
		**********				   * *
		SIMPLE MAZE ALGORITHMS	   * *
		**********				  ******
								   ***
									*
		**/

		function initialize_maze(){
			maze_matrix = new Array(size);
			for(var i=0; i<size; i++) {
			    maze_matrix[i] = new Array(size);
			    for(var j=0; j<size; j++) {
			    	maze_matrix[i][j] = 0;
			    }
			}
		}

		function generate_maze(){
			var x = 0;
			var y = 0;
			maze_matrix[x][y] = 1;
			while(x + 1 < size && y + 1 < size){
				var d = DIRECTIONS[Math.floor((Math.random()*4))];
				var dx = d[0];
				var dy = d[1];
				if(dx != 0){
					if(x + dx >= 0){
						x = x + dx;
					}
					else{
						continue;
					}
				}
				if(dy != 0){
					if(y + dy >= 0){
						y = y + dy;
					}
					else{
						continue;
					}
				}
				maze_matrix[x][y] = 1;
			}
		}

		function create_simple_maze_matrix(){
			initialize_maze();
			generate_maze();
		}

		function add_borders_simple(r, c){
			if(maze_matrix[r][c] != 1){
				return
			}
			var $block = $('#r'+r+'c'+c);
			var top_border = maze_matrix[r-1] != undefined && maze_matrix[r-1][c] == 1 ? '#5FBA50' : '#e96955'
			var bottom_border = maze_matrix[r+1] != undefined && maze_matrix[r+1][c] == 1 ? '#5FBA50' : '#e96955'
			var right_border = maze_matrix[r][c+1] == 1 ? '#5FBA50' : '#e96955'
			var left_border = maze_matrix[r][c-1] == 1 ? '#5FBA50' : '#e96955'

			$block.css('border-left-color', left_border);
			$block.css('border-right-color', right_border);
			$block.css('border-top-color', top_border);
			$block.css('border-bottom-color', bottom_border);
		}

		function simple_swipe(event, direction, distance, duration, fingerCount) {
			$("#message").text("");
        	var id = event.srcElement.id;
        	var tmp = id.split('r')[1].split('c');
		  	var r = parseInt(tmp[0]);
		  	var c = parseInt(tmp[1]);

		  	var new_r = r;
		  	var new_c = c;
		  	var translate;
		  	var map_translate;
		  	translate_percent = 100.00 / size;

		  	if(direction == 'right'){
		  		new_c = c-1;
		  		translate = "translate(-"+new_c * translate_percent+"%, -"+r * translate_percent+"%)"
		  		map_translate = "translate("+new_c * 100+"%, "+r * 100+"%)"
		  	}else if(direction == 'left'){
		  		new_c = c+1;
		  		translate = "translate(-"+ new_c * translate_percent+"%, -"+r * translate_percent+"%)"
		  		map_translate = "translate("+ new_c * 100+"%, "+r * 100+"%)"
		  	}else if(direction == 'down'){
		  		new_r = r-1;
		  		translate = "translate(-"+c * translate_percent+"%, -"+new_r * translate_percent+"%)"
		  		map_translate = "translate("+c * 100+"%, "+new_r * 100+"%)"
			}else if(direction == 'up'){
		  		new_r = r+1;
		  		translate = "translate(-"+c * translate_percent+"%, -"+new_r * translate_percent+"%)"
		  		map_translate = "translate("+c * 100+"%, "+new_r * 100+"%)"
		  	}

		  	var dead = false
		  	if(mode == 'zombies'){
		  		dead = is_caught_by_zombies(direction, last_direction);
		  	}

	  		if(!dead && maze_matrix[new_r] != undefined && maze_matrix[new_r][new_c] == 1){
	  			$("#maze_layout").css("transform",translate);
	  			$("#my_location").css("transform",map_translate);
	  			last_direction = direction;
	  		}else{
	  			if(mode == 'zombies' && dead){
	  				$("#message").text("You were caught by zombies, try again");
	  			}else{
	  			$("#message").text("You ran into a wall, try again");
	  			}
	  			$("#maze_layout").css("transform","translate(0%,0%)");
	  			$("#my_location").css("transform","translate(0%,0%)");
	  			last_direction = undefined;
	  		}

	  		if(new_r+1 == size || new_c+1 == size){
				$("#message").text("Congrats! You Win!!");
				$('#r'+new_r+'c'+new_c).addClass("good");
				$('#r'+new_r+'c'+new_c).text("YOU WIN!");
			}

        }


		/**
		**********				   * *
		SETUP MAZE	   			   * *
		**********				  ******
								   ***
									*
		**/

		function build_maze_layout(){
			$("#maze_layout").css("min-height", size*412+"px");
			$("#maze_layout").css("min-width", size*412+"px");
			$("#my_location").css("height", 100/size+"px");
			$("#my_location").css("width", 100/size+"px");
			for(var i=0; i<maze_matrix.length; i++){
				var row = maze_matrix[i];
				var first_row = true;
				for(var j=0; j<row.length; j++){
					$('#maze_layout').append('<div id="r'+i+'c'+j+'" class="maze_block"></div>');
					if(mode != "blind"){
						if(algorithm == 'advanced'){
							add_borders_advanced(i,j);
						}else{
							add_borders_simple(i,j);
						}
					}

					var swipe_function = algorithm == 'advanced' ? advanced_swipe : simple_swipe

					$('#r'+i+'c'+j).swipe( {
				        swipe:swipe_function,
				         threshold:0
				      });
				}
			}

			$("#r0c0").show();
		}

		function new_maze(){
			$("#maze_layout").css("transform","translate(0%,0%)");
			$("#my_location").css("transform","translate(0%,0%)");
			$('#maze_layout').empty()
			if(algorithm == 'advanced'){
				create_advanced_maze_matrix();
			}else{
				create_simple_maze_matrix();
			}
			build_maze_layout();
		}

		function initialize(){
			/*$('#show_all').click(
				function(){
					show_all();
				});*/
			$('#new_maze').click(
				function(){
					new_maze();
				});

			$('#settings').click(
				function () {
					$("#flipper").toggleClass("flipped")
				});
			$("#save_settings").click(
				function(){
					size=parseInt($("#size").val());
					mode = $("input[type='radio'][name='radio_mode']:checked").val();
					algorithm = $("input[type='radio'][name='radio_algorithm']:checked").val();
					new_maze();
					$("#flipper").toggleClass("flipped")
				});
			new_maze();
		}
	$(function(){
		$('#size').val(size);
		mode = $("input[type='radio'][name='radio_mode']:checked").val();
		algorithm = $("input[type='radio'][name='radio_algorithm']:checked").val();

	})
	</script>
	</head>
  <body onload="initialize()" class="ui-mobile-viewpoint">
  	<div data-role="page" id="pageone" data-theme="a">
	    <div data-role="header">
	      <h1>Swipe Maze</h1>
	      <a href="#" class="settings_btn" id="settings">Settings</a>
	    </div>

	    <div id="flipper">
	    <div id="settings_modal" class="ui-content settings_modal">
	    	<div data-role="controlgroup" data-type="horizontal">
		    	<!--<div class="field-contain">
			        <label for="size">Set Size of Maze</label>
			        <input type="text" name="size" id="size">
			    </div>-->
			    <fieldset data-role="controlgroup" data-type="horizontal" data-role="fieldcontain">
			    	<label for="size">Maze Size:</label>
			    	<input type="range" name="size" id="size" min="0" max="100" value="20" data-highlight="true">
			    	<legend>Choose maze algorithm:</legend>
		         	<input type="radio" name="radio_algorithm" id="radio_algorithm_simple" value="simple" />
		         	<label for="radio_algorithm_simple">Simple</label>
		         	<input type="radio" name="radio_algorithm" id="radio_algorithm_advanced" value="advanced" checked="checked" />
		         	<label for="radio_algorithm_advanced">Advanced</label>
			 	</fieldset>
			    <fieldset data-role="controlgroup" data-type="horizontal" data-role="fieldcontain">
			    	<legend>Choose a mode:</legend>
		         	<input type="radio" name="radio_mode" id="radio-choice-easy" value="easy" checked="checked" />
		         	<label for="radio-choice-easy">Normal</label>

		         	<input type="radio" name="radio_mode" id="radio-choice-blind" value="blind"  />
		         	<label for="radio-choice-blind">Blind</label>

		         	<input type="radio" name="radio_mode" id="radio-choice-zombies" value="zombies"  />
		         	<label for="radio-choice-zombies">Zombies</label>
			 	</fieldset>

			    <div id="save_settings" class="ui-btn">Save</div>
			</div>
		</div>

	    <div data-role="main" class="ui-content main">
	    	<div> Navigate through the maze by moving through green walls (Swipe away to move towards). If you hit a red wall, you will go back to the beginning. To win, reach one of the edges on the right or bottom. To change the size of the maze or other maze options, click the settings button. </div>
		  	<div data-role="controlgroup" data-type="horizontal">
			  	<!--<div id="show_all" class="ui-btn">Show All</div>-->
			  	<div id="new_maze" class="ui-btn">New Maze</div>
			  	<div id="message" class="message"></div>
			  	<div id="map" class="map">
			  		<img id="my_location" src="img/10x10blue_box.png"/>
			  	</div>
			</div>
		  	<div id="maze_holder">
		  		<div id="maze_layout">
		  		</div>
		  	</div>
		  </div>
		</div>
		<div data-role="footer">
		   <h1>Gui-on</h1>
		</div>
	</div>
  </body>
</html>